/*! (c) Developer Alex Dovby 
LampRemoteStats Release It is Created 11.02.2022 - 12:42:02,06 */
;var VERSION="11.02.2022";function getBrowser(){var a=navigator.userAgent;if(a.search(/MSIE/)>0){return"MSIE"}if(a.search(/Firefox/)>0){return"Firefox"}if(a.search(/Opera/)>0){return"Opera"}if(a.search(/Chrome/)>0){return"Chrome"}if(a.search(/Safari/)>0){return"Safari"}if(a.search(/Konqueror/)>0){return"Konqueror"}if(a.search(/Iceweasel/)>0){return"Iceweasel"}if(a.search(/SeaMonkey/)>0){return"SeaMonkey"}if(a.search(/Gecko/)>0){return"Gecko"}return"N/A"}function isDefined(a){return(a!==null&&a!==undefined)}function isUndefined(a){return(a===null||a===undefined)}function noCallback(a){}function getTimeFormatUTC(d){var b=Date.parse(d);var e="en-US";var a={year:"numeric",month:"long",day:"numeric",timezone:"UTC",hour:"numeric",minute:"numeric",second:"numeric"};var c=isNaN(b)?"&#8226;":new Date(b).toLocaleString(e,a);return c}function getServerSensorData(a,b){$.ajax({type:"GET",url:a,dataType:"json"}).done(function(c){b(c)}).error(function(){console.error("Error of performance")})}function uniqueKey(a){var c={};for(var b=0;b<a.length;b++){var d=a[b];c[d]=true}return Object.keys(c)}function getSumOfArray(c){var b=0;for(var a=0;a<c.length;a++){b+=parseInt(c[a])}return b}function getAverageValueOfArray(c){var b=0;for(var a=0;a<c.length;a++){b+=parseInt(c[a])}return Math.floor(b/c.length)}function getHTMLVariable(d){var a=location.search.substring(1).split("&");var b="";var c;for(c=0;c<a.length;c++){if(a[c].split("=")[0]===d){if(a[c].split("=").length>1){b=a[c].split("=")[1]}return b}}return""}function printJsonData(b,a){var c="json_list";if(isUndefined(document.getElementById(c))){return}document.getElementById(c).innerHTML='<p style="color:#FFF">CHANNEL • '+b+"</p><pre>"+syntaxHighlight(a)+"</pre>"}function syntaxHighlight(b){var a=(typeof(b)==="string")?b:JSON.stringify(b,undefined,2);a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return a.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(d){var c="number";if(/^"/.test(d)){if(/:$/.test(d)){c="key"}else{c="string"}}else{if(/true|false/.test(d)){c="boolean"}else{if(/null/.test(d)){c="null"}}}return'<span class="'+c+'">'+d+"</span>"})}var MAX_ATTEMPS=3;var attempts_connection=MAX_ATTEMPS;function curProperties(b){var a={results:60,timescale:1,type:"spline",yaxismax:60,yaxismin:30};switch(b){case"t1":case"t2":case"t3":lastGraph=b;break;default:break}a.results=RESULTS[lastGraph];a.type=TYPE[graph_count];a.yaxismax=RES_MAX[graph_count];a.yaxismin=RES_MIN[graph_count];return a}function ConnectionCloudThingspeak(d,c,e){document.getElementById("graph_title").innerHTML=BULL;document.getElementById("min_max").innerHTML=STR.connection[lang];var a="https://thingspeak.com/channels/"+CHANNEL+"/charts/"+CHARTS[d]+"?bgcolor=%23000&color=%23903&dynamic=true&results="+c.results+(isDefined(c.yaxismax)?"&yaxismax="+c.yaxismax:"")+(isDefined(c.yaxismin)?"&yaxismin="+c.yaxismin:"")+"&type="+c.type;var b=document.getElementById(CLOUD_FRAME);window.setTimeout(function(){b.src=a;b.onload=function(){e.call()}},150)}function sendRequestForCloud(){var a=$("#all_entries").hasClass("select")?entries:RESULTS[lastGraph];var b="?results="+a;getServerSensorData("https://api.thingspeak.com/channels/"+CHANNEL+"/feeds.json"+b,updateCloudData)}function sendRequestForCloudMinMaxData(){var a=$("#all_entries").hasClass("select")?entries:RESULTS[lastGraph];getServerSensorData("https://api.thingspeak.com/channels/"+CHANNEL+"/fields/"+CHARTS[graph_count]+".json?results="+a,updateCalculatedData)}function updateCalculatedData(b){var c=getCalculatedData(b.feeds);var d="";var a=KEY_GRAPH[graph_count];switch(a){case"app":d="1 &#8226; Android   |   2 &#8226;IOS   |   3 &#8226;Windows";break;case"maxUsedEffects":d=STR.max_use[lang]+c[a]+" "+SYM[graph_count];break;case"maxLeds":d=STR.max_use[lang]+c[a]+" "+SYM[graph_count];break;default:break}document.getElementById("graph_title").innerHTML=TITLE[graph_count];document.getElementById("min_max").innerHTML=d;document.getElementById("entries").innerHTML=b.feeds.length+" "+STR.entries[lang];closeSpiner()}function updateCloudData(a){updateDisplay(CHANNEL,getCloudData(a))}function updateDisplay(b,a){updateDisplayData(b,a);$("#srvState").toggleClass("ready",true);attempts_connection=MAX_ATTEMPS;window.setTimeout(function(){$("#receiver").toggleClass("receive",false)},500)}function updateMinMaxData(b){var d=b.feeds;var c="field"+CHARTS[graph_count];var a=[];document.getElementById("min_max").innerHTML="";for(i=0;i<d.length;++i){if(!isNaN(d[i][c])){a.push(d[i][c])}}document.getElementById("min_max").innerHTML="MIN &#8226; "+Math.min.apply(null,a).toFixed(1)+((SYM[graph_count]===" mmHg")?"":SYM[graph_count])+" | MAX &#8226; "+Math.max.apply(null,a).toFixed(1)+SYM[graph_count];closeSpiner()}function nextGraph(a){a.stopPropagation();var b=a.target.id;switch(b){case"t1":case"t2":case"t3":lastGraph=b;$("#spiner").show();$(".btn_timeline").toggleClass("select",false);$(a.target).toggleClass("select",true);$("#all_entries").html(getEntryButtonName());break;case"prev":clickVisualization(a);graph_count--;if(graph_count<0){graph_count=MAX_GRAPH-1}break;case"next":clickVisualization(a);graph_count++;if(graph_count>=MAX_GRAPH){graph_count=0}break;default:return}$("#icons").toggleClass("ie",(getBrowser()==="MSIE"));$("#icons").toggleClass("custom",(graph_count!==0));ConnectionCloudThingspeak(graph_count,curProperties(b),sendRequestForCloudMinMaxData)}function clickVisualization(a){$(a.target).toggleClass("select",true);$("#spiner").show();window.setTimeout(function(){$(a.target).toggleClass("select",false)},250)}function closeSpiner(){window.setTimeout(function(){$("#spiner").hide()},10)}function startAutoSendRequest(){intervalUpdateESP=setInterval(function(){$("#receiver").toggleClass("receive",true);sendRequestForCloud();attempts_connection--;if(attempts_connection===0){$("#srvState").toggleClass("ready",false);$("#statusLabel").html("connection error");attempts_connection=MAX_ATTEMPS}},60000)}function statsDataProto(a){this.time=a.created_at;this.app=a.field1;this.max_effects=a.field2;this.mobile=a.field3;this.used_lamps=a.field4;this.browser=a.field5;this.firmware=a.field6;this.max_leds=a.field7;this.ip=a.field8}function getCloudData(a){var b=getCalculatedData(a.feeds);b.last_entry_id=entries=a.channel.last_entry_id;b.entries=a.feeds.length;return b}function getCalculatedData(g){var p=[];var s=[];var l=[];var r=0;var h=[];var d=[];var q=[];var o=[];var f=[];var v={MSIE:0,Firefox:0,Chrome:0,Safari:0,Other:0};for(var t=0;t<g.length;t++){var k=new statsDataProto(g[t]);if(isDefined(k.mobile)){r+=Number(k.mobile)}if(isDefined(k.used_lamps)){s.push(parseInt(k.used_lamps))}if(isDefined(k.max_effects)){l.push(parseInt(k.max_effects))}if(isDefined(k.max_leds)){d.push(parseInt(k.max_leds))}if(isDefined(k.firmware)){h.push(Number(k.firmware.substr(0,3)))}if(isDefined(k.browser)){if(isDefined(v[k.browser])){v[k.browser]++}else{v.Other++}}if(isDefined(k.ip)){var j="|";if(isDefined(k.app)){switch(k.app){case"1":j+="m|";q.push(k.ip);break;case"3":j+="c|";o.push(k.ip);break;default:if(k.browser=="Safari"){f.push(k.ip)}j+="b|"+k.browser;break}}p.push(k.ip)}}var e=[];for(var u in v){e.push(v[u])}var m=Math.ceil(Math.max.apply(null,e)*1.1);e.length=0;var e=[];for(var u in s){e.push(s[u])}e.length=0;var n=uniqueKey(p).length;var c=uniqueKey(q).length;var b=uniqueKey(o).length;var a=uniqueKey(f).length;return{time:k.time,users:n,usersVisits:numberOfVisits(p),mobileDevice:r,verFirmware:uniqueKey(h),latestVersion:Math.max.apply(null,h),maxUsedLamps:Math.max.apply(null,s),maxLeds:Math.max.apply(null,d),maxUsedEffects:Math.max.apply(null,l),windowsApp:b,androidApp:c,iosApp:a,Browsers:v,BrowsersMaxUsed:m}}function numberOfVisits(a){var d=uniqueKey(a);var b={};for(var c=0;c<d.length;c++){b[d[c]]=0}for(var c=0;c<a.length;c++){b[a[c]]=b[a[c]]+1}return b}var BULL="&#8226;";var CHANNEL=178897;var MAX_GRAPH=3;var CLOUD_FRAME="web_graph";var RESULTS={t1:50,t2:500,t3:43200};var TIME_SCALE={t1:1,t2:20,t3:1440};var CHARTS=[1,2,7];var TYPE=["column","column","column"];var RES_MAX=[3.25,130,null];var RES_MIN=[0,75,null];var KEY_GRAPH=["app","maxUsedEffects","maxLeds"];var entries=60;var lastGraph="t1";var intervalUpdateESP;var graph_count=0;var lastGraph="t1";var CHART_BROWSER={Chrome:{},Firefox:{},MSIE:{},Safari:{},Other:{}};var STR={users:["уникальных пользователей","unique users"],latest_ver:["Последняя версия","Latest version"],num_leds:["количество светодиодов • max","number of LEDs • max"],os_android:["Платформа Android","android platform"],os_ios:["Платформа IOS","ios platform"],os_windows:["Платформа Windows","windows platform"],max_Lamps:["количество ламп в группе • max","Lamps in Group • max"],usage_browsers:["Использование браузеров","usage browsers"],connection:["подключение к веб-серверу","connection web server"],using_fw:["Использование версии прошивки","Using the firmware version"],entries:["записей","entries"],app_usage:["использование приложения","application usage statistics"],effects_usage:["использование эффектов","effects usage statistics"],matrix:["количество светодиодов","number of LEDs in the matrix • max"],max_use:["Максимальное использование ","Maximum use of "],effects:["еффектов","effects"],leds:["светодиодов","leds"]};var lang=0;var TITLE=[];var SYM=[];window.onload=function(){lang=Number(getHTMLVariable("lang"))||0;TITLE=[STR.app_usage[lang],STR.effects_usage[lang],STR.matrix[lang]];SYM=["•",STR.effects[lang],STR.leds[lang]];window.setTimeout(function(){showUI()},50);$("#ver").html("Version • "+VERSION);$("#debug").toggle(false)};function showUI(){var a=document.getElementById("win");if(a!=null){a.classList.add("css-fade")}createDisplays();ConnectionCloudThingspeak(graph_count,curProperties(lastGraph),sendRequestForCloudMinMaxData);sendRequestForCloud();startAutoSendRequest();$("#icons").toggleClass("ie",(getBrowser()==="MSIE"))}function clickControl(a){a.stopPropagation();var b=a.target.value;switch(b){case"back":$("#main_panel").toggle(true);$("#debug").toggle(false);break;case"update":$("#debug").toggle(true);$("#main_panel").toggle(false);break;case"swap_chart":$(a.target).toggleClass("select");$(a.target).html(getSwapButtonName($(a.target).hasClass("select")));sendRequestForCloud();break;case"all_entries":$(a.target).toggleClass("select");$(a.target).html(getEntryButtonName());sendRequestForCloud();break;default:break}}function updateDisplayData(b,a){printJsonData(b,a);updateLedDisplay("users",parseInt(a.users));updateLedDisplay("android",parseInt(a.androidApp));updateLedDisplay("ios",parseInt(a.iosApp));updateLedDisplay("windows",parseInt(a.windowsApp));updateLedDisplay("fw",a.latestVersion.toFixed(1));updateLedDisplay("leds",a.maxLeds);updateLedDisplay("lamps",a.maxUsedLamps);updateChartDisplay(a);updateLedDisplay("statusLabel",getTimeFormatUTC(a.time))}function createDisplays(){var a='<div class="ds_box">'+createLedDisplay("users",STR.users[lang],"users","")+createLedDisplay("fw",STR.latest_ver[lang],"fw","")+createLedDisplay("android",STR.os_android[lang],"android","")+createLedDisplay("ios",STR.os_ios[lang],"ios","")+createLedDisplay("windows",STR.os_windows[lang],"windows","")+createLedDisplay("leds",STR.num_leds[lang],"leds","")+createLedDisplay("lamps",STR.max_Lamps[lang],"lamp","")+'<div class="ds title_chart"><div  id="title_chart" class="cs_label">'+STR.usage_browsers[lang]+"</div></div>"+createChartDisplay("chart","***","")+createTimeLedDisplay(STR.connection[lang])+"</div>";document.getElementById("displays").innerHTML=a;$("#srvState").toggleClass("ready",false)}function createLedDisplay(e,a,b,d){var c='<div class="ds '+b+'"><p>'+a+'</p><div id="'+e+'" class="val">'+d+"</div></div>";return c}function updateLedDisplay(b,a){obj=document.getElementById(b);if(isDefined(obj)){obj.innerHTML=a}}function createChartDisplay(d,a,c){var b='<div class="ds chart"><div class="cs_chart_box"><div id="chart_grid" class="cs_chart"></div><div id="'+d+'" class="cs_chart_container"></div></div><button id="swap_chart" class="cs_btn_swap" value="swap_chart" onClick="clickControl(event)">'+getSwapButtonName(false)+'</button><button id="all_entries" class="cs_btn_all_entries" value="all_entries" onClick="clickControl(event)">'+getEntryButtonName()+"</button></div>";return b}function getSwapButtonName(a){var b=a?STR.usage_browsers[lang]:STR.using_fw[lang];return"• "+b+" •"}function getEntryButtonName(){var a={t1:BULL,t2:(BULL+BULL),t3:(BULL+BULL+BULL)};var b=$("#all_entries").hasClass("select")?"all":a[lastGraph];return b}function updateChartDisplay(l){var f=$("#swap_chart").hasClass("select")?Math.ceil(l.latestVersion*1.1):l.BrowsersMaxUsed;var j=$("#swap_chart").hasClass("select")?l.verFirmware:l.Browsers;var b=$("#swap_chart").hasClass("select")?j:CHART_BROWSER;var d=$("#swap_chart").hasClass("select")?" ver":"";$("#chart").empty();var n="";for(var a in b){n+='<div id="chart_'+a+'" class="chart_bar_box'+d+'"><div class="chart_bar_icon"></div></div>'}$("#chart").html(n);for(var a in j){var g=$("#swap_chart").hasClass("select")?"img/icon/'ic_firmware.png":getIconName(a);var m=Math.floor(j[a]/f*100);var k=' style="background-image:url('+g+');"';var e=' style="height:'+m+'%"';var c="#chart_"+a;var h='<div class="cs_chart_bar"'+e+'></div><div class="chart_bar_icon"'+k+'></div><div class="chart_bar_value">'+($("#swap_chart").hasClass("select")?Number(j[a]).toFixed(1):j[a])+"</div>";$(c).html(h)}$("#title_chart").html(getSwapButtonName(!$("#swap_chart").hasClass("select")));createGridDisplay(f)}function createGridDisplay(d){var c="";for(var b=4;b>=0;b--){var a=getChartStringValue(b*Math.floor(d/4));c+='<div class="cs_item_grid"><div class="grid_label">'+a+'</div><div class="grid_label right">'+a+"</div></div>"}$("#chart_grid").html(c)}function getChartStringValue(a){if(a>1000000){a=parseFloat(a/1000000).toFixed(1)+"M"}else{if(a>1000){a=parseFloat(a/1000).toFixed(1)+"k"}}return a}function createTimeLedDisplay(b){var a='<div id = "receiver" class="ds time receive"><div id="statusLabel" class="cs_label chip">'+b+'</div><div id="srvState" class="led_srv_state select"></div><button class="cs_btn_restart" value="update" onClick="clickControl(event)">•</button></div>';return a}function getIconName(a){return"img/icon/"+a+".png"};